"use strict";(globalThis.webpackChunkkubestellar_docs_initiative=globalThis.webpackChunkkubestellar_docs_initiative||[]).push([[3319],{1519(e,n,r){r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>p,frontMatter:()=>t,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"migration/from-cluster-api","title":"Migrating from Cluster API to KubeStellar","description":"Overview","source":"@site/docs/migration/from-cluster-api.md","sourceDirName":"migration","slug":"/migration/from-cluster-api","permalink":"/docs/migration/from-cluster-api","draft":false,"unlisted":false,"editUrl":"https://github.com/kubestellar/kubestellar/edit/main/kdemo/docs/migration/from-cluster-api.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Migrating from Karmada to KubeStellar","permalink":"/docs/migration/from-karmada"},"next":{"title":"Architecture Overview","permalink":"/docs/architecture/overview"}}');var l=r(4848),s=r(8453);const t={},a="Migrating from Cluster API to KubeStellar",o={},c=[{value:"Overview",id:"overview",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Migration Strategy",id:"migration-strategy",level:2},{value:"Assessment Phase",id:"assessment-phase",level:3},{value:"Preparation Phase",id:"preparation-phase",level:3},{value:"Migration Phase",id:"migration-phase",level:3},{value:"Step 1: Centralize workload definitions in WDS",id:"step-1-centralize-workload-definitions-in-wds",level:4},{value:"Step 2: Use BindingPolicy for placement",id:"step-2-use-bindingpolicy-for-placement",level:4},{value:"Step 3: Replace per-cluster deployment automation",id:"step-3-replace-per-cluster-deployment-automation",level:4},{value:"Validation Phase",id:"validation-phase",level:3},{value:"Cutover Phase",id:"cutover-phase",level:3},{value:"Comparison Table",id:"comparison-table",level:2},{value:"Common Pitfalls",id:"common-pitfalls",level:2},{value:"Rollback Plan",id:"rollback-plan",level:2},{value:"Post-Migration Optimization",id:"post-migration-optimization",level:2}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"migrating-from-cluster-api-to-kubestellar",children:"Migrating from Cluster API to KubeStellar"})}),"\n",(0,l.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,l.jsxs)(n.p,{children:["Cluster API (CAPI) primarily manages the ",(0,l.jsx)(n.strong,{children:"lifecycle of Kubernetes clusters"})," (create/upgrade/scale). Many teams also build deployment workflows around clusters that CAPI creates."]}),"\n",(0,l.jsx)(n.p,{children:"KubeStellar is complementary:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"CAPI can continue to manage cluster lifecycle"}),"\n",(0,l.jsxs)(n.li,{children:["KubeStellar focuses on ",(0,l.jsx)(n.strong,{children:"multi-cluster workload distribution and configuration"})]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"This guide describes how to move from \u201cCAPI-managed fleets + per-cluster deployments\u201d to \u201cCAPI-managed fleets + KubeStellar workload placement\u201d."}),"\n",(0,l.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Existing CAPI management cluster access"}),"\n",(0,l.jsx)(n.li,{children:"Inventory of workload clusters and their characteristics"}),"\n",(0,l.jsx)(n.li,{children:"A working KubeStellar ITS and WDS"}),"\n",(0,l.jsx)(n.li,{children:"Cluster credentials (kubeconfigs) for clusters you will register as WECs"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"migration-strategy",children:"Migration Strategy"}),"\n",(0,l.jsx)(n.h3,{id:"assessment-phase",children:"Assessment Phase"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["Inventory clusters created by CAPI:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Names, regions, environments"}),"\n",(0,l.jsx)(n.li,{children:"Add-ons (CNI, storage, ingress)"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Inventory current deployment method:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"GitOps per cluster? Helm per cluster? CI scripts?"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Identify cluster metadata you want as labels:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"environment"}),", ",(0,l.jsx)(n.code,{children:"region"}),", ",(0,l.jsx)(n.code,{children:"provider"}),", ",(0,l.jsx)(n.code,{children:"tier"}),", ",(0,l.jsx)(n.code,{children:"ring"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"preparation-phase",children:"Preparation Phase"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Register clusters as WECs in your ITS."}),"\n",(0,l.jsx)(n.li,{children:"Apply consistent labels in ITS."}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"kubectl config use-context its1\r\nkubectl label managedcluster wec-prod-1 environment=prod region=us-east provider=aws --overwrite\r\nkubectl label managedcluster wec-stage-1 environment=staging region=us-east provider=aws --overwrite\n"})}),"\n",(0,l.jsxs)(n.ol,{start:"3",children:["\n",(0,l.jsxs)(n.li,{children:["Define standard workload labels:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"app.kubernetes.io/name"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.code,{children:"app.kubernetes.io/part-of"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"migration-phase",children:"Migration Phase"}),"\n",(0,l.jsx)(n.h4,{id:"step-1-centralize-workload-definitions-in-wds",children:"Step 1: Centralize workload definitions in WDS"}),"\n",(0,l.jsx)(n.p,{children:"Instead of applying manifests to each cluster, apply them once to the WDS:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"apiVersion: apps/v1\r\nkind: Deployment\r\nmetadata:\r\n  name: api\r\n  namespace: platform-demo\r\n  labels:\r\n    app.kubernetes.io/name: api\r\n    app.kubernetes.io/part-of: platform-demo\r\nspec:\r\n  replicas: 2\r\n  selector:\r\n    matchLabels:\r\n      app.kubernetes.io/name: api\r\n  template:\r\n    metadata:\r\n      labels:\r\n        app.kubernetes.io/name: api\r\n    spec:\r\n      containers:\r\n      - name: api\r\n        image: ghcr.io/example/api:1.0.0\n"})}),"\n",(0,l.jsx)(n.h4,{id:"step-2-use-bindingpolicy-for-placement",children:"Step 2: Use BindingPolicy for placement"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"apiVersion: control.kubestellar.io/v1alpha1\r\nkind: BindingPolicy\r\nmetadata:\r\n  name: api-prod\r\n  namespace: platform-demo\r\nspec:\r\n  clusterSelectors:\r\n  - matchLabels:\r\n      environment: prod\r\n  downsync:\r\n  - objectSelectors:\r\n    - matchLabels:\r\n        app.kubernetes.io/part-of: platform-demo\r\n    resources:\r\n    - namespaces\r\n    - deployments\r\n    - services\n"})}),"\n",(0,l.jsx)(n.h4,{id:"step-3-replace-per-cluster-deployment-automation",children:"Step 3: Replace per-cluster deployment automation"}),"\n",(0,l.jsx)(n.p,{children:"You can typically remove:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u201cloop over kubeconfigs\u201d scripts in CI"}),"\n",(0,l.jsx)(n.li,{children:"multiple Argo instances per cluster (optional)"}),"\n",(0,l.jsx)(n.li,{children:"duplicated manifests per cluster (replace with labels + policies)"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"validation-phase",children:"Validation Phase"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"kubectl get bindings -n platform-demo --context wds1\r\nkubectl get deploy -n platform-demo --context wec-prod-1\r\nkubectl get deploy -n platform-demo --context wec-stage-1\n"})}),"\n",(0,l.jsx)(n.h3,{id:"cutover-phase",children:"Cutover Phase"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Freeze per-cluster deploy pipelines for migrated apps."}),"\n",(0,l.jsx)(n.li,{children:"Ensure KubeStellar policies are the single source of desired placement."}),"\n",(0,l.jsx)(n.li,{children:"Keep CAPI for lifecycle, but use KubeStellar for workloads going forward."}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"comparison-table",children:"Comparison Table"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Feature"}),(0,l.jsx)(n.th,{children:"Cluster API"}),(0,l.jsx)(n.th,{children:"KubeStellar"}),(0,l.jsx)(n.th,{children:"Notes"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Primary responsibility"}),(0,l.jsx)(n.td,{children:"Cluster lifecycle"}),(0,l.jsx)(n.td,{children:"Workload placement & sync"}),(0,l.jsx)(n.td,{children:"Complementary tools"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Selection mechanism"}),(0,l.jsx)(n.td,{children:"N/A"}),(0,l.jsx)(n.td,{children:"BindingPolicy clusterSelectors"}),(0,l.jsx)(n.td,{children:"Driven by cluster labels in ITS"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Workload rollout"}),(0,l.jsx)(n.td,{children:"External tooling"}),(0,l.jsx)(n.td,{children:"Policy-driven distribution"}),(0,l.jsx)(n.td,{children:"No manual context switching"})]})]})]}),"\n",(0,l.jsx)(n.h2,{id:"common-pitfalls",children:"Common Pitfalls"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Missing consistent labeling for CAPI clusters in ITS"}),"\n",(0,l.jsx)(n.li,{children:"Treating KubeStellar as a cluster lifecycle tool (it isn\u2019t)"}),"\n",(0,l.jsx)(n.li,{children:"Inconsistent base add-ons across WECs causing workload drift"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"rollback-plan",children:"Rollback Plan"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Keep old per-cluster deployment mechanism intact for a time"}),"\n",(0,l.jsx)(n.li,{children:"Remove BindingPolicies for rolled-back apps and re-enable previous pipeline"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"post-migration-optimization",children:"Post-Migration Optimization"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Auto-label clusters based on CAPI ClusterClass/metadata"}),"\n",(0,l.jsx)(n.li,{children:"Add ring-based promotion policies"}),"\n",(0,l.jsx)(n.li,{children:"Standardize \u201ccluster capability\u201d labels (gpu, storageclass, ingress)"}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},8453(e,n,r){r.d(n,{R:()=>t,x:()=>a});var i=r(6540);const l={},s=i.createContext(l);function t(e){const n=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);