"use strict";(globalThis.webpackChunkkubestellar_docs_initiative=globalThis.webpackChunkkubestellar_docs_initiative||[]).push([[1296],{5699(e,s,n){n.r(s),n.d(s,{assets:()=>a,contentTitle:()=>l,default:()=>p,frontMatter:()=>o,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"use-cases/crd-sync","title":"CRD Synchronization (Custom Resources Across Clusters)","description":"Problem Statement","source":"@site/docs/use-cases/crd-sync.md","sourceDirName":"use-cases","slug":"/use-cases/crd-sync","permalink":"/docs/use-cases/crd-sync","draft":false,"unlisted":false,"editUrl":"https://github.com/kubestellar/kubestellar/edit/main/kdemo/docs/use-cases/crd-sync.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Regional Compliance (Data Residency)","permalink":"/docs/use-cases/compliance"},"next":{"title":"Helm Chart Distribution","permalink":"/docs/use-cases/helm-charts"}}');var t=n(4848),i=n(8453);const o={},l="CRD Synchronization (Custom Resources Across Clusters)",a={},c=[{value:"Problem Statement",id:"problem-statement",level:2},{value:"Architecture",id:"architecture",level:2},{value:"Implementation Workflow",id:"implementation-workflow",level:2},{value:"Step 1: Ensure operators exist on WECs",id:"step-1-ensure-operators-exist-on-wecs",level:3},{value:"Step 2: Apply CRD in WDS",id:"step-2-apply-crd-in-wds",level:3},{value:"Step 3: Apply CustomResource instances in WDS",id:"step-3-apply-customresource-instances-in-wds",level:3},{value:"Step 4: BindingPolicy with CRD-first strategy",id:"step-4-bindingpolicy-with-crd-first-strategy",level:3},{value:"Recommended Configurations",id:"recommended-configurations",level:2},{value:"BindingPolicy Example",id:"bindingpolicy-example",level:3},{value:"Workload Example",id:"workload-example",level:3},{value:"Expected Outcomes",id:"expected-outcomes",level:2},{value:"Variations and Adaptations",id:"variations-and-adaptations",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const s={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"crd-synchronization-custom-resources-across-clusters",children:"CRD Synchronization (Custom Resources Across Clusters)"})}),"\n",(0,t.jsx)(s.h2,{id:"problem-statement",children:"Problem Statement"}),"\n",(0,t.jsxs)(s.p,{children:["You use Kubernetes operators (GitOps, service mesh, databases, platform APIs) that rely on ",(0,t.jsx)(s.strong,{children:"CRDs + CustomResources"}),". You need consistent CRD availability and CR instance deployment across a fleet of clusters."]}),"\n",(0,t.jsx)(s.h2,{id:"architecture",children:"Architecture"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"WDS"}),": source of truth for CRDs and CRs"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"ITS"}),": transports CRDs/CRs to labeled target clusters"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"WECs"}),": run operators and accept CRs once CRDs exist"]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"implementation-workflow",children:"Implementation Workflow"}),"\n",(0,t.jsx)(s.h3,{id:"step-1-ensure-operators-exist-on-wecs",children:"Step 1: Ensure operators exist on WECs"}),"\n",(0,t.jsx)(s.p,{children:"KubeStellar can distribute YAML, but operators often have lifecycle needs. In many orgs:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Operators are installed via a dedicated platform pipeline per cluster or per cluster group"}),"\n",(0,t.jsx)(s.li,{children:"KubeStellar then distributes CR instances (and sometimes CRDs)"}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"step-2-apply-crd-in-wds",children:"Step 2: Apply CRD in WDS"}),"\n",(0,t.jsx)(s.p,{children:"Example CRD snippet (shortened):"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:"apiVersion: apiextensions.k8s.io/v1\r\nkind: CustomResourceDefinition\r\nmetadata:\r\n  name: widgets.example.com\r\n  labels:\r\n    app.kubernetes.io/part-of: widgets\r\nspec:\r\n  group: example.com\r\n  names:\r\n    plural: widgets\r\n    singular: widget\r\n    kind: Widget\r\n  scope: Namespaced\r\n  versions:\r\n  - name: v1\r\n    served: true\r\n    storage: true\r\n    schema:\r\n      openAPIV3Schema:\r\n        type: object\n"})}),"\n",(0,t.jsx)(s.h3,{id:"step-3-apply-customresource-instances-in-wds",children:"Step 3: Apply CustomResource instances in WDS"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:"apiVersion: example.com/v1\r\nkind: Widget\r\nmetadata:\r\n  name: widget-demo\r\n  namespace: widgets\r\n  labels:\r\n    app.kubernetes.io/part-of: widgets\r\nspec:\r\n  size: small\n"})}),"\n",(0,t.jsx)(s.h3,{id:"step-4-bindingpolicy-with-crd-first-strategy",children:"Step 4: BindingPolicy with CRD-first strategy"}),"\n",(0,t.jsx)(s.p,{children:"A simple pattern is:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"downsync CRDs to all target clusters"}),"\n",(0,t.jsx)(s.li,{children:"downsync CRs to the same target clusters"}),"\n",(0,t.jsx)(s.li,{children:"ensure ordering by introducing \u201cphases\u201d in your rollout process (or pre-install CRDs)"}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:'apiVersion: control.kubestellar.io/v1alpha1\r\nkind: BindingPolicy\r\nmetadata:\r\n  name: widgets-crd-and-cr\r\nspec:\r\n  clusterSelectors:\r\n  - matchLabels:\r\n      widgets-enabled: "true"\r\n  downsync:\r\n  - objectSelectors:\r\n    - matchLabels:\r\n        app.kubernetes.io/part-of: widgets\r\n    resources:\r\n    - customresourcedefinitions\r\n    - namespaces\r\n    - widgets.example.com\n'})}),"\n",(0,t.jsxs)(s.blockquote,{children:["\n",(0,t.jsxs)(s.p,{children:["Note: The exact ",(0,t.jsx)(s.code,{children:"resources"})," value for a CR kind depends on the resource discovery and how you express it in your environment. The prototype shows the intent: \u201cCRDs + CRs to the same clusters.\u201d"]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"recommended-configurations",children:"Recommended Configurations"}),"\n",(0,t.jsx)(s.h3,{id:"bindingpolicy-example",children:"BindingPolicy Example"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:"apiVersion: control.kubestellar.io/v1alpha1\r\nkind: BindingPolicy\r\nmetadata:\r\n  name: operator-crs\r\nspec:\r\n  clusterSelectors:\r\n  - matchLabels:\r\n      operator: widgets\r\n  downsync:\r\n  - objectSelectors:\r\n    - matchLabels:\r\n        app.kubernetes.io/part-of: widgets\r\n    resources:\r\n    - namespaces\r\n    - customresourcedefinitions\n"})}),"\n",(0,t.jsx)(s.h3,{id:"workload-example",children:"Workload Example"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:"apiVersion: example.com/v1\r\nkind: Widget\r\nmetadata:\r\n  name: widget-prod\r\n  namespace: widgets\r\n  labels:\r\n    app.kubernetes.io/part-of: widgets\r\nspec:\r\n  size: large\n"})}),"\n",(0,t.jsx)(s.h2,{id:"expected-outcomes",children:"Expected Outcomes"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"CRDs are present where needed"}),"\n",(0,t.jsx)(s.li,{children:"CR instances are created consistently across the fleet"}),"\n",(0,t.jsx)(s.li,{children:"Operators can act on CRs without \u201cunknown kind\u201d failures"}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"variations-and-adaptations",children:"Variations and Adaptations"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Pre-install CRDs/operators, then use KubeStellar for CRs only"}),"\n",(0,t.jsx)(s.li,{children:"Use labels to target subsets (dev/stage/prod)"}),"\n",(0,t.jsx)(s.li,{children:"Add transforms for cluster-specific values (storage classes, endpoints)"}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"If CRs fail: verify CRD exists on WEC first"}),"\n",(0,t.jsx)(s.li,{children:"Check for ordering issues: CR delivered before CRD"}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Document an \u201coperator lifecycle\u201d pattern (who installs operators, how upgrades happen)"}),"\n",(0,t.jsx)(s.li,{children:"Add a validation step that asserts CRD presence before rolling CRs"}),"\n"]})]})}function p(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453(e,s,n){n.d(s,{R:()=>o,x:()=>l});var r=n(6540);const t={},i=r.createContext(t);function o(e){const s=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),r.createElement(i.Provider,{value:s},e.children)}}}]);